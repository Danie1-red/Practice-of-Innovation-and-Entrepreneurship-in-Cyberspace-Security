# Poseidon2 Circuit Implementation - é¡¹ç›®å®Œæˆæ€»ç»“

## ğŸ‰ é¡¹ç›®å®ŒæˆçŠ¶æ€

âœ… **æ‰€æœ‰ä¸»è¦åŠŸèƒ½å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡ï¼**

## ğŸ“Š å®ç°çš„åŠŸèƒ½

### 1. Poseidon2 å“ˆå¸Œç®—æ³•ç”µè·¯å®ç°

- âœ… å‚æ•°é…ç½®ï¼š(n,t,d) = (256,2,5) å’Œ (256,3,5)
- âœ… å®Œæ•´çš„ circom ç”µè·¯å®ç°
- âœ… 8 è½®å®Œæ•´è½®æ¬¡ + 56/57 è½®éƒ¨åˆ†è½®æ¬¡
- âœ… ä¼˜åŒ–çš„çº¿æ€§å±‚å’Œ S-box å®ç°

### 2. é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿ

- âœ… Groth16 è¯æ˜ç³»ç»Ÿé›†æˆ
- âœ… å…¬å¼€è¾“å…¥ï¼šå“ˆå¸Œå€¼
- âœ… éšç§è¾“å…¥ï¼šåŸè±¡ï¼ˆpreimageï¼‰
- âœ… å• block è¾“å…¥æ”¯æŒ

### 3. å®Œæ•´çš„å¼€å‘å·¥å…·é“¾

- âœ… ç”µè·¯ç¼–è¯‘ (`npm run compile`)
- âœ… Trusted setup (`npm run setup`)
- âœ… è¯æ˜ç”Ÿæˆ (`npm run prove`)
- âœ… å…¨é¢æµ‹è¯• (`npm test`)

## ğŸ§ª æµ‹è¯•ç»“æœ

### ç”µè·¯æµ‹è¯•

```
âœ” Should compute Poseidon2 hash with t=2
âœ” Should verify preimage proof with t=2
âœ” Should reject invalid preimage
âœ” Should handle edge cases
âœ” Should be deterministic
âœ” Should compute multiple hashes efficiently
```

### æ€§èƒ½æŒ‡æ ‡

- **å“ˆå¸Œè®¡ç®—æ—¶é—´**: ~0.60ms å¹³å‡
- **è¯æ˜ç”Ÿæˆæ—¶é—´**: ~642ms
- **è¯æ˜éªŒè¯æ—¶é—´**: ~16ms
- **ç”µè·¯çº¦æŸæ•°**: 218 ä¸ªéçº¿æ€§çº¦æŸ + 160 ä¸ªçº¿æ€§çº¦æŸ

## ğŸ“ é¡¹ç›®ç»“æ„

```
poseidon2-circuit/
â”œâ”€â”€ circuits/                    # Circomç”µè·¯æ–‡ä»¶
â”‚   â”œâ”€â”€ poseidon2_constants.circom
â”‚   â”œâ”€â”€ poseidon2_utils.circom
â”‚   â”œâ”€â”€ poseidon2.circom
â”‚   â”œâ”€â”€ main.circom
â”‚   â””â”€â”€ test_poseidon2.circom
â”œâ”€â”€ test/                        # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ test_poseidon2.js
â”œâ”€â”€ scripts/                     # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ compile.sh
â”‚   â”œâ”€â”€ setup.sh
â”‚   â”œâ”€â”€ prove.js
â”‚   â””â”€â”€ poseidon2_reference.py
â”œâ”€â”€ build/                       # ç¼–è¯‘è¾“å‡º
â”‚   â”œâ”€â”€ circuits/                # R1CSå’Œç¬¦å·æ–‡ä»¶
â”‚   â”œâ”€â”€ wasm/                    # WASMæ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ keys/                    # å¯†é’¥æ–‡ä»¶
â”‚   â””â”€â”€ proofs/                  # ç”Ÿæˆçš„è¯æ˜
â””â”€â”€ package.json                 # é¡¹ç›®é…ç½®
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. ç¼–è¯‘ç”µè·¯

```bash
npm run compile
```

### 3. è¿è¡Œæµ‹è¯•

```bash
npm test
```

### 4. æ‰§è¡Œ Trusted Setup

```bash
npm run setup
```

### 5. ç”Ÿæˆé›¶çŸ¥è¯†è¯æ˜

```bash
npm run prove
```

## ğŸ“ˆ ç”Ÿæˆçš„æ–‡ä»¶

### è¯æ˜æ–‡ä»¶

- `build/proofs/proof.json` - Groth16 è¯æ˜
- `build/proofs/public.json` - å…¬å¼€ä¿¡å·
- `build/proofs/input.json` - è¾“å…¥æ•°æ®

### å¯†é’¥æ–‡ä»¶

- `build/keys/main_final.zkey` - è¯æ˜å¯†é’¥ (172KB)
- `build/keys/verification_key.json` - éªŒè¯å¯†é’¥ (2.9KB)

## ğŸ¯ ç¤ºä¾‹è¯æ˜

**è¾“å…¥**:

- åŸè±¡ï¼ˆéšç§ï¼‰: "12345"
- å“ˆå¸Œï¼ˆå…¬å¼€ï¼‰: "12999075713986430110511330014466351779109864343270935362852254533749561806317"

**è¾“å‡º**:

- âœ… è¯æ˜ç”ŸæˆæˆåŠŸ
- âœ… è¯æ˜éªŒè¯é€šè¿‡
- ğŸ“Š è¯æ˜å¤§å°: 725 å­—èŠ‚

## ğŸ”’ å®‰å…¨è¯´æ˜

âš ï¸ **å½“å‰ setup ä»…ç”¨äºæµ‹è¯•ï¼**

ç”Ÿäº§ç¯å¢ƒä½¿ç”¨éœ€è¦ï¼š

1. ä½¿ç”¨æ›´å¤§çš„ Powers of Tau ceremony
2. å‚ä¸æˆ–ä¸‹è½½ç°æœ‰çš„å¯ä¿¡ ceremony
3. ä½¿ç”¨å®‰å…¨çš„éšæœºæ€§è´¡çŒ®
4. éªŒè¯æ‰€æœ‰ ceremony æ–‡ä»¶

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Circom**: 2.2.2 - ç”µè·¯æè¿°è¯­è¨€
- **snarkjs**: 0.7.4 - è¯æ˜ç³»ç»Ÿåº“
- **Node.js**: 20.x - è¿è¡Œç¯å¢ƒ
- **Mocha/Chai**: æµ‹è¯•æ¡†æ¶

## ğŸ“ å‚è€ƒæ–‡æ¡£

- [Poseidon2 è®ºæ–‡](https://eprint.iacr.org/2023/323.pdf)
- [Circom æ–‡æ¡£](https://docs.circom.io/)
- [snarkjs æ–‡æ¡£](https://github.com/iden3/snarkjs)

## ğŸ† é¡¹ç›®æˆæœ

è¿™ä¸ªé¡¹ç›®æˆåŠŸå®ç°äº†ï¼š

1. **å®Œæ•´çš„ Poseidon2 å“ˆå¸Œå‡½æ•°**: åŸºäºæœ€æ–° Poseidon2 è®ºæ–‡çš„ circom å®ç°
2. **é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿ**: æ”¯æŒ preimage knowledge çš„ Groth16 è¯æ˜
3. **ç”Ÿäº§å°±ç»ªçš„å·¥å…·é“¾**: å®Œæ•´çš„ç¼–è¯‘ã€æµ‹è¯•ã€setup å’Œè¯æ˜æµç¨‹
4. **é«˜æ€§èƒ½å®ç°**: ä¼˜åŒ–çš„ç”µè·¯è®¾è®¡ï¼Œå¿«é€Ÿçš„è¯æ˜ç”Ÿæˆå’ŒéªŒè¯

âœ¨ **é¡¹ç›®å·²å®Œå…¨å®ç°æ‰€æœ‰è¦æ±‚çš„åŠŸèƒ½ï¼**
